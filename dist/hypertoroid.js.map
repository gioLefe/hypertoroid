{
  "version": 3,
  "sources": ["../src/core/assets-manager.ts", "../src/models/game.ts", "../src/core/di-container.ts", "../src/core/audio-controller.ts", "../src/helpers/canvas.ts", "../src/helpers/color-heap.ts", "../src/helpers/math.ts", "../src/helpers/polygon.ts", "../src/helpers/rect-collision.ts", "../src/helpers/sat-collision.ts", "../src/models/color.ts", "../src/core/interaction-manager.ts", "../src/core/scene-manager.ts", "../src/core/settings.ts", "../src/models/base-object.ts", "../src/models/game-object.ts", "../src/models/structs/linked-list.ts", "../src/models/structs/quad-tree.ts", "../src/models/unit-vector.ts", "../src/mixins/with-dragging.ts", "../src/mixins/with-interaction-manager.ts", "../src/ui/canvas/helpers/text.ts", "../src/ui/controls/button.ts", "../src/ui/controls/label.ts", "../src/ui/controls/panel.ts", "../src/ui/controls/window.ts"],
  "sourcesContent": ["import { ImageAsset, GenericFileAsset, SoundAsset, Tag } from \"../models/asset\";\nimport { AssetsHandler } from \"./types/assets-handler\";\nimport { GameAssetRequest } from \"./types/game-asset\";\n\nexport class AssetsManager implements AssetsHandler {\n  assets: Map<string, ImageAsset | SoundAsset | GenericFileAsset> = new Map();\n\n  add(assetRequests: GameAssetRequest[]): Promise<void>[] {\n    return assetRequests.map((request) =>\n      this.createObjectPromise(this, request)\n    );\n  }\n\n  find<T = ImageAsset | SoundAsset | GenericFileAsset>(\n    id: string\n  ): T | undefined {\n    return this.assets.get(id) as T;\n  }\n  delete(id: string): void {\n    this.assets.delete(id);\n  }\n  addTag(id: string, tag: Tag): void {\n    const a = this.assets.get(id);\n    if (a === undefined) {\n      console.warn(`cannot find asset ${id}`);\n      return;\n    }\n    a.tags.push(tag);\n    this.assets.set(id, a);\n  }\n  update<T extends ImageAsset | SoundAsset | GenericFileAsset>(\n    id: string,\n    asset: T\n  ): void {\n    if (this.assets.has(id) === false) {\n      console.warn(`Cannot find asset ${id}`);\n      return;\n    }\n    this.assets.set(id, asset);\n  }\n  updateId(oldId: string, newId: string): void {\n    if (this.assets.has(oldId) === false) {\n      console.warn(`Cannot find asset ${oldId}`);\n      return;\n    }\n    const asset = this.assets.get(oldId);\n    if (asset === undefined) {\n      console.warn(`Cannot find asset ${oldId}`);\n      return;\n    }\n    this.assets.set(newId, asset);\n    this.assets.delete(oldId);\n  }\n\n  /**\n   * Get all pixel data from an image asset\n   * @param assetId - The ID of the image asset\n   * @returns ImageData object or null if asset not found or not an image\n   */\n  getImageData(assetId: string): ImageData | null {\n    const asset = this.assets.get(assetId);\n    if (\n      !asset ||\n      !(\"source\" in asset) ||\n      !(asset.source instanceof HTMLImageElement)\n    ) {\n      return null;\n    }\n\n    const image = asset.source as HTMLImageElement;\n\n    const canvas = document.createElement(\"canvas\");\n    const ctx = canvas.getContext(\"2d\");\n\n    if (!ctx) {\n      return null;\n    }\n\n    canvas.width = image.width;\n    canvas.height = image.height;\n    ctx.drawImage(image, 0, 0);\n\n    return ctx.getImageData(0, 0, image.width, image.height);\n  }\n\n  private createObjectPromise(\n    assetManagerHandle: this,\n    assetRequest: GameAssetRequest\n  ): Promise<void> {\n    return new Promise<void>((resolve, reject) => {\n      let obj: HTMLImageElement;\n\n      let responseType: XMLHttpRequestResponseType;\n      switch (assetRequest.type) {\n        case \"AUDIO\":\n          // generic raw binary data buffer -> https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer\n          responseType = \"arraybuffer\";\n          break;\n        case \"JSON\":\n          responseType = \"json\";\n          break;\n        default:\n          responseType = \"\";\n      }\n\n      switch (assetRequest.type) {\n        case \"TEXT\":\n        case \"JSON\":\n        case \"AUDIO\":\n          const request = new XMLHttpRequest();\n          request.open(\"GET\", assetRequest.path, true);\n          request.responseType = responseType;\n          request.onload = function () {\n            assetManagerHandle.assets.set(assetRequest.id, {\n              source: request.response,\n              tags: [],\n              ...assetRequest,\n            });\n            return resolve();\n          };\n          request.onerror = function () {\n            reject(`cannot load ${assetRequest.id} at ${assetRequest.path}`);\n          };\n          request.send();\n          break;\n        case \"IMAGE\":\n          obj = new Image();\n          obj.onload = function () {\n            assetManagerHandle.assets.set(assetRequest.id, {\n              source: obj as HTMLImageElement,\n              tags: [],\n              ...assetRequest,\n            });\n            return resolve();\n          };\n          obj.onerror = function () {\n            reject(`cannot load ${assetRequest.id} at ${assetRequest.path}`);\n          };\n          obj.src = assetRequest.path;\n          break;\n          default: reject(`unsupported asset type ${assetRequest.type}`);\n      }\n    });\n  }\n}\n", "import {\n  DIContainer,\n  SceneHandler,\n  Settings,\n  SceneManager,\n  AudioController,\n  AssetsManager,\n} from \"../core\";\nimport { AssetsHandler } from \"../core/types/assets-handler\";\nimport { GameCycle } from \"./game-cycle\";\n\nexport const SCENE_MANAGER_DI = \"SceneManager\";\nexport const ASSETS_MANAGER_DI = \"AsetsManager\";\n\nexport abstract class Game implements GameCycle {\n  protected canvas: HTMLCanvasElement;\n  protected ctx: CanvasRenderingContext2D;\n\n  private lastUpdateTime: number = 0;\n  private deltaTime: number = 0;\n  private frameInterval: number = 0;\n  protected diContainer = DIContainer.getInstance();\n\n  protected sceneManager: SceneHandler | undefined;\n  protected assetsManager: AssetsHandler | undefined;\n  protected settingsManager: Settings | undefined;\n\n  private debug: { init: boolean; update: boolean; render: boolean } = {\n    init: false,\n    update: false,\n    render: false,\n  };\n\n  constructor(\n    canvas: HTMLCanvasElement,\n    canvasWidth: number,\n    canvasHeight: number,\n    fps: number = 30\n  ) {\n    if (canvas === null) {\n      console.error(`%c *** Error, Canvas cannot be null`);\n      throw Error();\n    }\n\n    this.canvas = canvas;\n    this.canvas.width = canvasWidth;\n    this.canvas.height = canvasHeight;\n\n    const context = this.canvas.getContext(\"2d\");\n    if (context === null) {\n      throw Error(\"ctx is null\");\n    }\n\n    this.ctx = context;\n\n    this.lastUpdateTime = 0;\n    this.deltaTime = 0;\n    this.frameInterval = 1000 / fps;\n\n    this.init();\n  }\n  clean(..._args: any) {\n    throw new Error(\"Method not implemented.\");\n  }\n\n  async init(): Promise<void> {\n    if (this.debug.init) {\n      console.log(`%c *** Init`, `background:#020; color:#adad00`);\n    }\n\n    this.sceneManager = new SceneManager();\n    this.assetsManager = new AssetsManager();\n    this.settingsManager = new Settings();\n    this.diContainer.register<SceneHandler>(\n      SCENE_MANAGER_DI,\n      this.sceneManager\n    );\n    this.diContainer.register<AssetsHandler>(\n      ASSETS_MANAGER_DI,\n      this.assetsManager\n    );\n    this.diContainer.register<AudioController>(\n      AudioController.AUDIO_CONTROLLER_DI,\n      new AudioController()\n    );\n    this.diContainer.register<Settings>(\n      Settings.SETTINGS_DI,\n      this.settingsManager\n    );\n  }\n\n  async update(deltaTime: number): Promise<void> {\n    if (this.debug.update) {\n      console.log(`%c *** Update`, `background:#020; color:#adad00`);\n    }\n\n    const currentScenes = this.sceneManager?.getCurrentScenes();\n    if (!currentScenes) {\n      console.warn(\"no scene to update\");\n      return;\n    }\n\n    for (const scene of currentScenes) {\n      try {\n        await scene.update(deltaTime);\n      } catch (error) {\n        console.error(\"Scene update failed:\", error);\n      }\n    }\n  }\n\n  render(..._args: any): void {\n    if (this.debug.render) {\n      console.log(`%c *** Render`, `background:#020; color:#adad00`);\n    }\n    this.ctx?.clearRect(0, 0, this.canvas.width, this.canvas.height);\n\n    const currentScenes = this.sceneManager?.getCurrentScenes();\n    if (currentScenes === undefined) {\n      console.warn(\"no scene to render\");\n      return;\n    }\n\n    currentScenes.forEach((scene) => scene.render(this.ctx));\n  }\n\n  gameLoop = async (timestamp: number): Promise<void> => {\n    if (this.lastUpdateTime === 0) {\n      this.lastUpdateTime = timestamp;\n    }\n\n    const elapsed = timestamp - this.lastUpdateTime;\n\n    if (elapsed > this.frameInterval) {\n      this.deltaTime = this.frameInterval / 1000;\n\n      // Account for frame timing drift\n      this.lastUpdateTime = timestamp - (elapsed % this.frameInterval);\n\n      await this.update(this.deltaTime);\n      this.render(this.ctx);\n    }\n    requestAnimationFrame(this.gameLoop);\n  };\n\n  start(): void {\n    this.lastUpdateTime = performance.now();\n    this.gameLoop(this.lastUpdateTime);\n  }\n}\n", "/**\n * A Dependency Injection (DI) container for registering and resolving dependencies.\n * This class follows the Singleton pattern to ensure only one instance is used.\n */\nexport class DIContainer {\n  /**\n   * The single instance of the DIContainer.\n   * @type {DIContainer}\n   * @private\n   * @static\n   */\n  private static instance: DIContainer;\n\n  /**\n   * A map to store registered dependencies.\n   * @type {Map<string, any>}\n   * @private\n   */\n  private dependencies: Map<string, any> = new Map();\n\n  /**\n   * Private constructor to prevent direct instantiation.\n   * Use {@link DIContainer.getInstance} to get the single instance of this class.\n   * @private\n   */\n  private constructor() {}\n\n  /**\n   * Gets the single instance of the DIContainer.\n   * If no instance exists, it creates one.\n   *\n   * @returns {DIContainer} The singleton instance of the DIContainer.\n   * @static\n   */\n  static getInstance(): DIContainer {\n    if (!DIContainer.instance) {\n      DIContainer.instance = new DIContainer();\n    }\n    return DIContainer.instance;\n  }\n\n  /**\n   * Registers a dependency with a specific name.\n   *\n   * @template T\n   * @param {string} name - The name of the dependency.\n   * @param {T} dependency - The dependency to register.\n   * @returns {void}\n   */\n  register<T>(name: string, dependency: T): void {\n    this.dependencies.set(name, dependency);\n  }\n\n  /**\n   * Resolves a dependency by its name.\n   * Throws an error if the dependency is not found.\n   *\n   * @template T\n   * @param {string} name - The name of the dependency to resolve.\n   * @returns {T} The resolved dependency.\n   * @throws {Error} If the dependency is not found.\n   */\n  resolve<T>(name: string): T {\n    const dependency = this.dependencies.get(name);\n    if (!dependency) {\n      throw new Error(`Dependency ${name} not found`);\n    }\n    return dependency;\n  }\n}\n", "import { SoundAsset } from \"../models/asset\";\r\nimport { ASSETS_MANAGER_DI } from \"../models/game\";\r\nimport { AssetsManager } from \"./assets-manager\";\r\nimport { DIContainer } from \"./di-container\";\r\nimport { AudioPlayingOptions } from \"./types/audio-playing-options\";\r\n\r\nconst MAX_VOLUME = 1;\r\n\r\nexport class AudioController {\r\n  static AUDIO_CONTROLLER_DI = \"AudioController\";\r\n\r\n  private assetsManager =\r\n    DIContainer.getInstance().resolve<AssetsManager>(ASSETS_MANAGER_DI);\r\n  private audioContext = new AudioContext();\r\n  private mainGainNode = this.audioContext.createGain();\r\n  private playingSounds: Record<string, AudioPlayingOptions> = {};\r\n\r\n  constructor() {\r\n    this.mainGainNode.gain.value = MAX_VOLUME;\r\n    this.mainGainNode.connect(this.audioContext.destination);\r\n  }\r\n\r\n  get playingAssetsIds() {\r\n    return Object.keys(this.playingSounds);\r\n  }\r\n\r\n  setMainVolume(value: number) {\r\n    this.mainGainNode.gain.value =\r\n      value >= 0 && value <= MAX_VOLUME ? value : MAX_VOLUME;\r\n  }\r\n\r\n  getMainVolume(): number {\r\n    return this.mainGainNode.gain.value;\r\n  }\r\n\r\n  playAsset(\r\n    id: string,\r\n    audioPlayingOptions: AudioPlayingOptions = { loop: false, force: true },\r\n  ) {\r\n    const soundAsset: SoundAsset | undefined =\r\n      this.assetsManager.find<SoundAsset>(id);\r\n    if (soundAsset === undefined) {\r\n      console.warn(\"Can`t find asset\", id);\r\n    }\r\n    if (\r\n      this.playingAssetsIds.indexOf(id) > -1 &&\r\n      audioPlayingOptions.force === false\r\n    ) {\r\n      return;\r\n    }\r\n    this.playingSounds[id] = audioPlayingOptions;\r\n\r\n    const arrayBuffer = this.assetsManager.find<SoundAsset>(id)?.source;\r\n    if (arrayBuffer === undefined) {\r\n      return;\r\n    }\r\n\r\n    // THIS IS INCONVENIENT!\r\n    // we are doing 2 operations (cloning buffer, and then decode) each time we want to play a sound, and this comes at a cost!\r\n    // Look for a solution\r\n    this.audioContext\r\n      .decodeAudioData(arrayBuffer.slice(0))\r\n      .then((audioBuffer) => {\r\n        const audioBufferSourceNode = this.audioContext.createBufferSource();\r\n        audioBufferSourceNode.buffer = audioBuffer;\r\n        audioBufferSourceNode.connect(this.mainGainNode);\r\n        audioBufferSourceNode.start();\r\n        audioBufferSourceNode.loop = audioPlayingOptions.loop;\r\n        audioBufferSourceNode.addEventListener(\"ended\", () => {\r\n          Object.entries(this.playingSounds).forEach((n) => {\r\n            if (n[0] === id) {\r\n              console.log(`Audio buffer ended event: ${id}`);\r\n              delete this.playingSounds[id];\r\n            }\r\n          });\r\n        });\r\n      });\r\n  }\r\n}\r\n", "export function drawRotated(\n  ctx: CanvasRenderingContext2D,\n  canvasW: number,\n  canvasH: number,\n  img: HTMLImageElement,\n  degrees: number,\n) {\n  ctx.clearRect(0, 0, canvasW, canvasH);\n\n  // save the unrotated ctx of the canvas so we can restore it later\n  // the alternative is to untranslate & unrotate after drawing\n  ctx.save();\n\n  // move to the center of the canvas\n  ctx.translate(canvasW / 2, canvasH / 2);\n\n  // rotate the canvas to the specified degrees\n  ctx.rotate((degrees * Math.PI) / 180);\n\n  // draw the image\n  // since the ctx is rotated, the image will be rotated also\n  ctx.drawImage(img, -img.width / 2, -img.width / 2);\n\n  // we\u2019re done with the rotating so restore the unrotated ctx\n  ctx.restore();\n}\n", "import { HitBoxColor } from \"../core\";\r\n\r\nexport class ColorHeap {\r\n  private freedColors: HitBoxColor[] = [];\r\n  private nextColor: HitBoxColor = { r: 1, g: 0, b: 0, a: 255 };\r\n\r\n  getNext(): HitBoxColor {\r\n    let color = this.freedColors.shift();\r\n    if (color !== undefined) {\r\n      return color;\r\n    }\r\n    color = { ...this.nextColor };\r\n    \r\n    // Increment color for next allocation\r\n    this.nextColor.r += 1;\r\n    if (this.nextColor.r > 255) {\r\n      this.nextColor.r = 0;\r\n      this.nextColor.g += 1;\r\n      if (this.nextColor.g > 255) {\r\n        this.nextColor.g = 0;\r\n        this.nextColor.b += 1;\r\n        if (this.nextColor.b > 255) {\r\n          throw new Error(\"Ran out of unique colors\");\r\n        }\r\n      }\r\n    }\r\n    return color;\r\n  }\r\n}\r\n", "import { MinMax } from \"../models/min-max\";\nimport { Vec2 } from \"../models/vec\";\n\nexport function getVectorPerpendicular(\n  axis: Vec2<number>,\n): Vec2<number> | null {\n  if (!axis) {\n    console.warn(`%c *** axis is null`, `background:#222; color: #bada55`);\n    return null;\n  }\n\n  return { x: -axis.y, y: axis.x };\n}\n\n/** Checks for overlap between tw intervalso */\nexport function intervalsOverlap(\n  intervalA: MinMax,\n  intervalB: MinMax,\n): boolean {\n  return !(intervalA.max < intervalB.min || intervalB.max < intervalA.min);\n}\n\n/**\n * Returns a 'number' with decimals up to the precision\n * @param num\n * @param precision\n * @returns\n */\nexport function toPrecisionNumber(num: number, precision: number): number {\n  return parseFloat(num.toPrecision(precision));\n}\n\nexport function diffVectors(vec1: Vec2<number>, vec2: Vec2<number>): number {\n  // Use Pitagora theorem to calculate the vectors\n  const vec1Length = Math.sqrt(Math.pow(vec1.x, 2) + Math.pow(vec1.y, 2));\n  const vec2Length = Math.sqrt(Math.pow(vec2.x, 2) + Math.pow(vec2.y, 2));\n  return vec1Length - vec2Length;\n}\n\nexport function createVector(\n  direction: number,\n  distance: number,\n  origin: Vec2<number> = { x: 0, y: 0 },\n): Vec2<number> {\n  return {\n    x: Math.cos(direction) * distance + origin.x,\n    y: Math.sin(direction) * distance + origin.y,\n  };\n}\n\n/**\n * Calculates the dot product of two 2-dimensional vectors.\n *\n * @param {Vec2<number>} a - The first vector.\n * @param {Vec2<number>} b - The second vector.\n * @returns {number} The dot product of vectors a and b.\n *\n * @example\n * // Define two vectors\n * const vectorA = { x: 1, y: 2 };\n * const vectorB = { x: 3, y: 4 };\n *\n * // Calculate the dot product\n * const result = dotProduct(vectorA, vectorB);\n * // result is 11 (1*3 + 2*4)\n */\nexport function dotProduct(a: Vec2<number>, b: Vec2<number>): number {\n  return a.x * b.x + a.y * b.y;\n}\n\nexport function magnitude(v: Vec2<number>): number {\n  return Math.sqrt(v.x * v.x + v.y * v.y);\n}\n\n/** Project a polygon onto an axis */\nexport function projectPolygonToAxis(\n  vertices: Vec2<number>[],\n  axis: Vec2<number>,\n): MinMax {\n  let min = Number.POSITIVE_INFINITY;\n  let max = Number.NEGATIVE_INFINITY;\n\n  // Loop through each vertex of the polygon\n  for (const vertice of vertices) {\n    // Project the vertex onto the axis using the dot product\n    const projection = dotProduct(vertice, axis);\n\n    // Update the minimum and maximum projection values\n    if (projection < min) {\n      min = projection;\n    }\n    if (projection > max) {\n      max = projection;\n    }\n  }\n\n  // Return the min and max projections\n  return { min, max };\n}\n\nexport function angleBetween(\n  v1: Vec2<number>,\n  v2: Vec2<number>,\n  tolerance: number = 1e-6,\n): number {\n  const dot = dotProduct(v1, v2);\n  const magProduct = magnitude(v1) * magnitude(v2);\n  if (magProduct === 0) return 0; // To handle division by zero\n\n  const cosTheta = dot / magProduct;\n  const cosThetaClamped = Math.min(1, Math.max(-1, cosTheta)); // Ensure cosTheta is within [-1, 1]\n\n  const theta = Math.acos(cosThetaClamped);\n\n  // Calculate the cross product to determine the sign of the angle\n  const crossProduct = v1.x * v2.y - v1.y * v2.x;\n  const angle = crossProduct >= 0 ? theta : -theta;\n\n  // If the absolute difference between the angle and zero is within the tolerance, consider it as zero\n  if (Math.abs(angle) <= tolerance) {\n    return 0;\n  }\n\n  return angle;\n}\n\nexport function randomIntFromInterval(min: number, max: number): number {\n  // min and max included\n  return Math.floor(Math.random() * (max - min + 1) + min);\n}\n", "import { BoundingBox } from \"../models\";\nimport { Polygon } from \"../models/polygon\";\nimport { Vec2 } from \"../models/vec\";\nimport { getVectorPerpendicular } from \"./math\";\nimport { WorldPolygon } from \"./sat-collision\";\n\nexport interface RenderingPolygonParams\n  extends Partial<CanvasFillStrokeStyles> {\n  strokeColor?: string;\n  selectedStrokeColor?: string;\n  collisionStrokeColor?: string;\n  worldCoordinates: Vec2<number>;\n}\n\nconst DEFAULT_POLYGON_PARAMS: RenderingPolygonParams = {\n  strokeColor: \"#000000\",\n  selectedStrokeColor: \"#aa0000\",\n  collisionStrokeColor: \"#00a4FF\",\n  worldCoordinates: { x: 0, y: 0 },\n};\n\nexport function renderPolygon(\n  polygon: Polygon,\n  ctx: CanvasRenderingContext2D,\n  options: RenderingPolygonParams = DEFAULT_POLYGON_PARAMS\n): void {\n  if (!polygon) {\n    console.error(\"Polygon is null\");\n    return;\n  }\n  if (polygon.points.length < 2) {\n    console.warn(\"Too few points , can't draw polygon \");\n    return;\n  }\n\n  // Move to the first point, calculated as the origin summed to the first point coordinates\n  const origin: Vec2<number> = {\n    x: options.worldCoordinates.x + polygon.points[0].x,\n    y: options.worldCoordinates.y + +polygon.points[0].y,\n  };\n  ctx.moveTo(origin.x, origin.y);\n  ctx.strokeStyle = options.strokeColor ?? DEFAULT_POLYGON_PARAMS.strokeColor!;\n  ctx.lineWidth = 1;\n\n  if (polygon.color) {\n    ctx.fillStyle = polygon.color;\n  }\n\n  ctx.beginPath();\n  for (let i = 1; i < polygon.points.length; i++) {\n    ctx.lineTo(\n      options.worldCoordinates.x + polygon.points[i].x,\n      options.worldCoordinates.y + +polygon.points[i].y\n    );\n  }\n  ctx.lineTo(origin.x, origin.y);\n  ctx.closePath();\n  if (polygon.fill) {\n    ctx.fill();\n  }\n  if (polygon.outline) {\n    ctx.stroke();\n  }\n}\n\nexport function createTriangle(\n  height: number,\n  color: string = \"#ffb3ba\"\n): Polygon | null {\n  if (height === 0) {\n    console.warn(\"height cannot be 0\");\n    return null;\n  }\n  return {\n    color,\n    fill: true,\n    points: [\n      { x: -height / 2, y: 0 },\n      { x: height / 2, y: height / 2 },\n      { x: height / 2, y: -height / 2 },\n    ],\n    sideLength: (2 * height) / Math.sqrt(3),\n  } as Polygon;\n}\n\nexport function createSquare(\n  sideLength: number,\n  color: string = \"#ffb3ba\"\n): Polygon | null {\n  if (sideLength === 0) {\n    console.warn(\"sideLength cannot be 0\");\n    return null;\n  }\n  return {\n    color,\n    fill: true,\n    points: [\n      { x: -sideLength / 2, y: sideLength / 2 },\n      { x: sideLength / 2, y: sideLength / 2 },\n      { x: sideLength / 2, y: -sideLength / 2 },\n      { x: -sideLength / 2, y: -sideLength / 2 },\n    ],\n    sideLength,\n  } as Polygon;\n}\n\nexport function createPolygon(defaults: Partial<Polygon> = {}): Polygon {\n  return {\n    color: defaults.color ?? \"#ffb3ba\",\n    fill: defaults.fill ?? true,\n    outline: defaults.outline ?? true,\n    numSides: defaults.numSides ?? 3,\n    points: generatePolygonPoints(\n      defaults.numSides ?? 3,\n      defaults.sideLength ?? 10\n    ),\n    sideLength: defaults.sideLength ?? 22,\n  } as Polygon;\n}\n\nexport function updatePolygonShape(polygon: Polygon) {\n  return {\n    ...polygon,\n    points: generatePolygonPoints(polygon.numSides, polygon.sideLength),\n  } as Polygon;\n}\n\nexport function rotatePolygon(polygon: Polygon, radiants: number): Polygon {\n  return {\n    ...polygon,\n    points: generatePolygonPoints(\n      polygon.numSides,\n      polygon.sideLength,\n      radiants\n    ),\n  };\n}\n\nexport function calculateNormals(points: Vec2<number>[]): Vec2<number>[] {\n  return calculateEdgesPerpendiculars(points).reduce(\n    (accumulation: Vec2<number>[], current: Vec2<number>) => {\n      return accumulation.some(\n        (n) =>\n          Math.abs(n.y) === Math.abs(current.y) &&\n          Math.abs(n.x) === Math.abs(current.x)\n      )\n        ? accumulation\n        : accumulation.concat(current);\n    },\n    []\n  );\n}\n\nexport function calculateEdgesPerpendiculars(\n  points: Vec2<number>[]\n): Vec2<number>[] {\n  const perpendiculars: Vec2<number>[] = [];\n\n  const numPoints = points.length;\n\n  for (let i = 0; i < numPoints; i++) {\n    const p1 = points[i];\n    const p2 = points[(i + 1) % numPoints]; // Next point (wraps around to the first point)\n\n    // Calculate edge vector\n    const edge: Vec2<number> = {\n      x: p2.x - p1.x,\n      y: p2.y - p1.y,\n    };\n\n    // Calculate perpendicular axis by swapping x and y and negating one\n    const perpendicularAxis = getVectorPerpendicular(edge);\n    if (perpendicularAxis === null) {\n      console.warn(\n        `%c *** Cannot calculate perpendicular for edge`,\n        `background:#222; color: #FFda55`,\n        edge\n      );\n      continue;\n    }\n\n    // Normalize the perpendicular axis\n    const length = Math.sqrt(\n      perpendicularAxis.x * perpendicularAxis.x +\n        perpendicularAxis.y * perpendicularAxis.y\n    );\n    perpendicularAxis.x /= length;\n    perpendicularAxis.y /= length;\n\n    perpendiculars.push(perpendicularAxis);\n  }\n\n  return perpendiculars;\n}\n\nexport function getBBoxRect(\n  buondingBox: BoundingBox<number>,\n  defaults: Partial<Polygon> = {}\n): Polygon {\n  return {\n    color: defaults.color ?? \"#ffb3ba\",\n    fill: defaults.fill ?? true,\n    outline: defaults.outline ?? true,\n    numSides: 4,\n    points: [\n      { x: buondingBox.nw.x, y: buondingBox.nw.y },\n      { x: buondingBox.se.x, y: buondingBox.nw.y },\n      { x: buondingBox.se.x, y: buondingBox.se.y },\n      { x: buondingBox.nw.x, y: buondingBox.se.y },\n    ],\n  } as Polygon;\n}\n\nexport function getWorldPolygon(\n  polygon: Polygon,\n  position: Vec2<number>\n): WorldPolygon {\n  return {\n    ...polygon,\n    worldCoordinates: { x: position.x, y: position.y },\n  };\n}\n\nexport function printWorldPolygonInfo(\n  polygon: WorldPolygon,\n  label = \"polygon\"\n) {\n  console.log(\n    `${label}: sides: ${polygon.numSides} | center: x:${polygon?.worldCoordinates.x.toFixed(1)}, y:${polygon?.worldCoordinates.y.toFixed(1)} | points: ${polygon.points.forEach((p, i) => `p[${i}]-${p.x}:${p.y},`)} | normals: ${polygon.normals?.forEach((n, i) => `n[${i}]-${n.x}:${n.y},`)}`\n  );\n}\n\nexport function createBoundingBox(\n  x: number,\n  y: number,\n  width: number,\n  height: number\n): BoundingBox<number> {\n  return { nw: { x, y }, se: { x: x + width, y: y + height } };\n}\n\nfunction generatePolygonPoints(\n  numSides: number,\n  sideLength: number,\n  radiants?: number\n): Vec2<number>[] {\n  const points: Vec2<number>[] = [];\n  let fullCircle = 2 * Math.PI;\n  const angleIncrement = fullCircle / numSides;\n\n  for (let i = 0; i < numSides; i++) {\n    let angle = i * angleIncrement;\n    if (radiants) {\n      angle = angle + radiants;\n    }\n\n    const x = sideLength * Math.cos(angle);\n    const y = sideLength * Math.sin(angle);\n    points.push({ x, y });\n  }\n\n  return points;\n}\n", "import { BoundingBox, Vec2 } from \"../models\";\n\nexport function isPointInAlignedBBox(\n  point: Vec2<number>,\n  bbox: BoundingBox<number>,\n) {\n  return (\n    point.x >= bbox.nw.x &&\n    point.x <= bbox.se.x &&\n    point.y >= bbox.nw.y &&\n    point.y <= bbox.se.y\n  );\n}\n", "import { intervalsOverlap, projectPolygonToAxis } from \".\";\nimport { Polygon, Vec2 } from \"../models\";\n\n/** A polygon with world coordinates information */\nexport type WorldPolygon = Polygon & {\n  worldCoordinates: Vec2<number>;\n};\n\nexport function satCollision(\n  polygonA: WorldPolygon,\n  polygonB: WorldPolygon,\n): boolean {\n  if (polygonA.normals === undefined) {\n    return false;\n  }\n  for (let z = 0; z < polygonA.normals.length; z++) {\n    // 1. Transform polygons points to space coordinates\n    const polAVertices = polygonA.points.map((point) => ({\n      x: point.x + polygonA.worldCoordinates.x,\n      y: point.y + polygonA.worldCoordinates.y,\n    }));\n    const polBVertices = polygonB.points.map((point) => ({\n      x: point.x + polygonB.worldCoordinates.x,\n      y: point.y + polygonB.worldCoordinates.y,\n    }));\n\n    // 2. Project vertices onto the perpendiculars\n    const polAProjection = projectPolygonToAxis(\n      polAVertices,\n      polygonA.normals[z],\n    );\n    const polBProjection = projectPolygonToAxis(\n      polBVertices,\n      polygonA.normals[z],\n    );\n\n    if (!intervalsOverlap(polAProjection, polBProjection)) {\n      //  if at least one perpendicular has no overlaps, they are separated\n      return false;\n    }\n  }\n  // All normals have been checked and all projections overlap, hence the two polygons collide\n  return true;\n}\n", "export type Color = {\r\n  r: number;\r\n  g: number;\r\n  b: number;\r\n  a: number;\r\n};\r\n\r\nexport const RED: Color = { r: 255, g: 0, b: 0, a: 255 };\r\nexport const GREEN: Color = { r: 0, g: 255, b: 0, a: 255 };\r\nexport const BLUE: Color = { r: 0, g: 0, b: 255, a: 255 };\r\nexport const YELLOW: Color = { r: 255, g: 255, b: 0, a: 255 };\r\n\r\nexport function isSameColor(color: Color, colorToCompare: Color): boolean {\r\n  return (\r\n    color.r === colorToCompare.r &&\r\n    color.g === colorToCompare.g &&\r\n    color.b === colorToCompare.b &&\r\n    color.a === colorToCompare.a\r\n  );\r\n}\r\n\r\nexport function colorToString(color: Color) {\r\n  return `rgba(${color.r},${color.g},${color.b},${color.a})`;\r\n}\r\n\r\n\r\nconst pixelColorCache: Color = { r: 0, g: 0, b: 0, a: 0 };\r\nexport function getCtxPixelColor(\r\n  x: number,\r\n  y: number,\r\n  ctx: OffscreenCanvasRenderingContext2D | CanvasRenderingContext2D\r\n): Color {\r\n  const data = ctx.getImageData(x, y, 1, 1).data;\r\n  pixelColorCache.r = data[0];\r\n  pixelColorCache.g = data[1];\r\n  pixelColorCache.b = data[2];\r\n  pixelColorCache.a = data[3];\r\n  return pixelColorCache;\r\n}\r\n\r\nexport function colorize(\r\n  image: HTMLImageElement,\r\n  r: number,\r\n  g: number,\r\n  b: number\r\n) {\r\n  const imageSize = image.width;\r\n\r\n  const offscreen = new OffscreenCanvas(imageSize, imageSize);\r\n  const ctx = offscreen.getContext(\"2d\")!;\r\n\r\n  ctx.drawImage(image, 0, 0);\r\n\r\n  const imageData = ctx.getImageData(0, 0, imageSize, imageSize);\r\n\r\n  for (let i = 0; i < imageData.data.length; i += 4) {\r\n    imageData.data[i + 0] *= r;\r\n    imageData.data[i + 1] *= g;\r\n    imageData.data[i + 2] *= b;\r\n  }\r\n\r\n  ctx.putImageData(imageData, 0, 0);\r\n\r\n  return offscreen;\r\n}\r\n", "import { ColorHeap, isPointInAlignedBBox } from \"../helpers\";\r\nimport { BoundingBox, Vec2 } from \"../models\";\r\nimport {\r\n  Color,\r\n  colorize,\r\n  colorToString,\r\n  getCtxPixelColor,\r\n  isSameColor,\r\n} from \"../models/color\";\r\nimport { EventType } from \"./types/event-type\";\r\n\r\nexport type HitTestFn = (\r\n  point: Vec2<number>,\r\n  ctx: OffscreenCanvasRenderingContext2D\r\n) => boolean;\r\n\r\nexport type Callback<K extends keyof HTMLElementEventMap> = (\r\n  ev: HTMLElementEventMap[K]\r\n) => any;\r\n\r\nexport type EventCallback = Partial<{\r\n  [key in EventType]: Callback<key>;\r\n}>;\r\n\r\nexport type HitBoxColor = Color & {\r\n  a: 255; // Ensure fully opaque for hitbox rendering\r\n};\r\n\r\nexport type HitBoxData = {\r\n  isDragging: boolean;\r\n};\r\n\r\n/**\r\n * Unified hitbox + event definition.\r\n * Spatial hitbox with optional event callbacks and priority layer.\r\n */\r\nexport type HitboxEvent = {\r\n  id: string;\r\n  layer?: number; // 0-100; higher = higher priority. Defaults to 0.\r\n\r\n  // Spatial definition (at least one should be provided)\r\n  getBoundingBox?: () => BoundingBox<number> | undefined;\r\n  hitTest?: HitTestFn;\r\n  color?: HitBoxColor;\r\n  image?: HTMLImageElement;\r\n\r\n  // Event callbacks\r\n  callbacks?: EventCallback;\r\n\r\n  // Metadata\r\n  data?: Partial<HitBoxData>;\r\n};\r\n\r\nexport type HitboxEventId = string;\r\n\r\nexport class InteractionManager {\r\n  static INTERACTION_MANAGER_ID = \"InteractionManager\";\r\n\r\n  private canvas: HTMLCanvasElement;\r\n  private hitboxEvents = new Map<HitboxEventId, HitboxEvent>();\r\n  private hitboxArray: HitboxEvent[] | null = null;\r\n  private hitBoxCanvas: OffscreenCanvas = new OffscreenCanvas(0, 0);\r\n  private hitBoxOffscreenCtx: OffscreenCanvasRenderingContext2D =\r\n    this.hitBoxCanvas.getContext(\"2d\", { willReadFrequently: true })!;\r\n  private colorizedCache = new Map<string, OffscreenCanvas>();\r\n\r\n  private keyboardFocusId: string | null = null;\r\n  private mouseMoveTargetId: string | null = null;\r\n  private mouseOutCallback: Callback<\"mouseout\"> | null = null;\r\n  private mouseDownTargetId: string | null = null;\r\n  private mouseUpCallback: Callback<\"mouseup\"> | null = null;\r\n\r\n  colorHeap = new ColorHeap();\r\n\r\n  constructor(canvas: HTMLCanvasElement) {\r\n    this.canvas = canvas;\r\n    this.updateCanvasSize(canvas.width, canvas.height);\r\n  }\r\n\r\n  registerEventListener(\r\n    evType: EventType,\r\n    options?: boolean | AddEventListenerOptions\r\n  ) {\r\n    this.canvas.addEventListener(evType, this.listener, options);\r\n  }\r\n\r\n  /**\r\n   * Query the highest-priority hitbox at a point.\r\n   * Returns undefined if no hitbox matches.\r\n   */\r\n  getHitboxAt(point: Vec2<number>): HitboxEvent | undefined {\r\n    let winner: HitboxEvent | undefined;\r\n    let highestLayer = -Infinity;\r\n\r\n    for (const hb of this.hitboxEvents.values()) {\r\n      if (this.hitTest(hb, point)) {\r\n        const layer = hb.layer ?? 0;\r\n        if (layer > highestLayer) {\r\n          highestLayer = layer;\r\n          winner = hb;\r\n        }\r\n      }\r\n    }\r\n    return winner;\r\n  }\r\n\r\n  updateCanvasSize(width: number, height: number) {\r\n    this.hitBoxCanvas.width = width;\r\n    this.hitBoxCanvas.height = height;\r\n  }\r\n\r\n  registerKeyboardFocus(id: string) {\r\n    this.keyboardFocusId = id;\r\n  }\r\n  deregisterKeyboardFocus() {\r\n    this.keyboardFocusId = null;\r\n  }\r\n\r\n  // CRUD\r\n  upsertHitbox(id: string, options: Partial<HitboxEvent>): void {\r\n    const existing = this.hitboxEvents.get(id);\r\n    this.hitboxEvents.set(id, {\r\n      id,\r\n      layer: options.layer ?? existing?.layer ?? 0,\r\n      getBoundingBox: options.getBoundingBox ?? existing?.getBoundingBox,\r\n      hitTest: options.hitTest ?? existing?.hitTest,\r\n      color: options.color ?? existing?.color,\r\n      image: options.image ?? existing?.image,\r\n      callbacks: options.callbacks ?? existing?.callbacks,\r\n      data: options.data ?? existing?.data,\r\n    });\r\n    this.hitboxArray = null;\r\n  }\r\n  removeHitbox(id: string): void {\r\n    this.hitboxEvents.delete(id);\r\n    this.hitboxArray = null;\r\n  }\r\n  hasHitBox(hbId: string): boolean {\r\n    return this.hitboxEvents.has(hbId);\r\n  }\r\n\r\n  /**\r\n   * Renders hitboxes to the offscreen canvas, sorted by layer priority.\r\n   * This offscreen canvas is used by hitTest() for pixel-perfect collision detection.\r\n   * Higher layer values are rendered last (on top), ensuring they win priority queries.\r\n   */\r\n  render(\r\n    ctx: OffscreenCanvasRenderingContext2D | CanvasRenderingContext2D = this\r\n      .hitBoxOffscreenCtx\r\n  ) {\r\n    if (!ctx) return;\r\n\r\n    ctx.clearRect(0, 0, this.hitBoxCanvas.width, this.hitBoxCanvas.height);\r\n\r\n    for (const hitboxEvent of this.getHitboxArray()) {\r\n      const bbox = hitboxEvent.getBoundingBox?.();\r\n      if (!bbox || !hitboxEvent.color) continue;\r\n\r\n      if (hitboxEvent.image) {\r\n        const colorized = this.colorizeCached(\r\n          hitboxEvent.image,\r\n          hitboxEvent.color\r\n        );\r\n        ctx.drawImage(colorized, bbox.nw.x, bbox.nw.y);\r\n        continue;\r\n      }\r\n\r\n      const colorString = colorToString(hitboxEvent.color);\r\n      ctx.fillStyle = colorString;\r\n      ctx.strokeStyle = colorString;\r\n      ctx.fillRect(\r\n        bbox.nw.x,\r\n        bbox.nw.y,\r\n        bbox.se.x - bbox.nw.x,\r\n        bbox.se.y - bbox.nw.y\r\n      );\r\n    }\r\n  }\r\n\r\n  clean(evTypes: EventType[]): void {\r\n    for (const evType of evTypes) {\r\n      this.canvas.removeEventListener(evType, this.listener);\r\n    }\r\n    this.hitboxEvents.clear();\r\n    this.hitboxArray = null;\r\n    this.colorizedCache.clear();\r\n  }\r\n\r\n  private listener: EventListener = <K extends EventType>(\r\n    htmlEv: HTMLElementEventMap[K]\r\n  ) => {\r\n    const evType = htmlEv.type as K;\r\n\r\n    // Keyboard events: dispatch to all listeners\r\n    if (evType.indexOf(\"key\") === 0) {\r\n      // If something has focus, only it receives the event\r\n      if (this.keyboardFocusId) {\r\n        const focused = this.hitboxEvents.get(this.keyboardFocusId);\r\n        const callback = focused?.callbacks?.[evType];\r\n        if (callback) {\r\n          callback(htmlEv);\r\n        }\r\n        return; // Don't bubble to other listeners\r\n      }\r\n\r\n      const canvasHitBox = this.getCanvasEvent(evType);\r\n      if (canvasHitBox) {\r\n        canvasHitBox.callbacks?.[evType]?.(htmlEv);\r\n      }\r\n    }\r\n    const point = this.extractPoint(htmlEv);\r\n    if (!point) return;\r\n\r\n    // Mouse/pointer events: find highest-priority hitbox and invoke only that\r\n    let hitBoxEvent = this.getHitboxAt(point);\r\n    if (!hitBoxEvent) {\r\n      // No hitbox found; call global callbacks on canvas (if any registered)\r\n      hitBoxEvent = this.getCanvasEvent(evType);\r\n    }\r\n\r\n    if (!hitBoxEvent) return;\r\n\r\n    const callback = hitBoxEvent.callbacks?.[evType];\r\n    if (callback) {\r\n      callback(htmlEv);\r\n    }\r\n\r\n    this.handleMouseButtonRelease(htmlEv, evType, hitBoxEvent);\r\n    this.handleMouseMove(htmlEv, evType, hitBoxEvent);\r\n  };\r\n\r\n  private extractPoint(\r\n    ev: HTMLElementEventMap[keyof HTMLElementEventMap]\r\n  ): Vec2<number> | null {\r\n    if (\"offsetX\" in ev && \"offsetY\" in ev) {\r\n      return { x: ev.offsetX, y: ev.offsetY };\r\n    }\r\n    return null;\r\n  }\r\n\r\n  private hitTest(hitboxEvent: HitboxEvent, point: Vec2<number>): boolean {\r\n    // bbox test first\r\n    if (hitboxEvent.getBoundingBox) {\r\n      const bbox = hitboxEvent.getBoundingBox();\r\n      if (!bbox || !isPointInAlignedBBox(point, bbox)) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    // custom hit test\r\n    if (hitboxEvent.hitTest) {\r\n      return hitboxEvent.hitTest(point, this.hitBoxOffscreenCtx);\r\n    }\r\n\r\n    // color-based (offscreen canvas pixel-perfect)\r\n    if (hitboxEvent.color) {\r\n      const pixel = getCtxPixelColor(point.x, point.y, this.hitBoxOffscreenCtx);\r\n      return isSameColor(pixel, hitboxEvent.color);\r\n    }\r\n\r\n    // bbox passed or no constraints\r\n    return hitboxEvent.getBoundingBox !== undefined;\r\n  }\r\n\r\n  private colorizeCached(\r\n    image: HTMLImageElement,\r\n    color: Color\r\n  ): OffscreenCanvas {\r\n    const key = `${image.src}:${color.r},${color.g},${color.b},${color.a}`;\r\n    let cached = this.colorizedCache.get(key);\r\n    if (!cached) {\r\n      cached = colorize(image, color.r, color.g, color.b);\r\n      this.colorizedCache.set(key, cached);\r\n    }\r\n    return cached;\r\n  }\r\n\r\n  private getHitboxArray(): HitboxEvent[] {\r\n    if (!this.hitboxArray) {\r\n      this.hitboxArray = Array.from(this.hitboxEvents.values()).sort(\r\n        (a, b) => (a.layer ?? 0) - (b.layer ?? 0)\r\n      );\r\n    }\r\n    return this.hitboxArray;\r\n  }\r\n\r\n  private getCanvasEvent(evType: EventType): HitboxEvent | undefined {\r\n    if (!this.hitboxArray) {\r\n      return undefined;\r\n    }\r\n    return this.hitboxArray?.find((hb) => {\r\n      return (\r\n        hb.getBoundingBox === undefined &&\r\n        hb.hitTest === undefined &&\r\n        hb.color === undefined &&\r\n        hb.image === undefined &&\r\n        hb.callbacks?.[evType]\r\n      );\r\n    });\r\n  }\r\n\r\n  /** Handle mouse button release across different hitboxes.\r\n   * Ensures that if a mousedown occurs on one hitbox and mouseup on another,\r\n   * the original hitbox's mouseup callback is still invoked.\r\n   */\r\n  private handleMouseButtonRelease = (\r\n    htmlEv: HTMLElementEventMap[keyof HTMLElementEventMap],\r\n    evType: EventType,\r\n    hitBoxEvent: HitboxEvent\r\n  ) => {\r\n    if (evType === \"mousedown\" && this.mouseUpCallback === null) {\r\n      this.mouseUpCallback = hitBoxEvent.callbacks?.[\"mouseup\"] || null;\r\n      this.mouseDownTargetId = hitBoxEvent.id || null;\r\n    }\r\n\r\n    if (evType === \"mouseup\" && this.mouseUpCallback) {\r\n      if (this.mouseDownTargetId !== hitBoxEvent.id) {\r\n        this.mouseUpCallback(htmlEv as HTMLElementEventMap[\"mouseup\"]);\r\n        this.mouseUpCallback = null;\r\n      }\r\n      this.mouseDownTargetId = null;\r\n    }\r\n  };\r\n\r\n  /** Handle mouse hover, dragging and mouseout across different hitboxes.\r\n   * Ensures that if a mousedown occurs on one hitbox and mouseup on another,\r\n   * the original hitbox's mouseup callback is still invoked.\r\n   */\r\n  private handleMouseMove = (\r\n    htmlEv: HTMLElementEventMap[keyof HTMLElementEventMap],\r\n    evType: EventType,\r\n    hitBoxEvent: HitboxEvent\r\n  ) => {\r\n    if (evType !== \"mousemove\") {\r\n      return;\r\n    }\r\n\r\n    // handle the case where the mouse was previously over another hitbox and mousedown is also set (means a drag could be happening)\r\n    if (this.mouseDownTargetId && this.mouseDownTargetId !== hitBoxEvent.id) {\r\n      const originalHitbox = this.hitboxEvents.get(this.mouseDownTargetId);\r\n\r\n      // if dragging, invoke the mousemove callback of the original hitbox\r\n      const mouseMoveCallback = originalHitbox?.callbacks?.[\"mousemove\"];\r\n      if (mouseMoveCallback && originalHitbox.data?.isDragging) {\r\n        mouseMoveCallback(htmlEv as HTMLElementEventMap[\"mousemove\"]);\r\n        return;\r\n      }\r\n    }\r\n\r\n    if (evType === \"mousemove\" && this.mouseOutCallback === null) {\r\n      this.mouseOutCallback = hitBoxEvent.callbacks?.[\"mouseout\"] || null;\r\n      this.mouseMoveTargetId = hitBoxEvent.id || null;\r\n    }\r\n\r\n    if (evType === \"mousemove\" && this.mouseOutCallback) {\r\n      if (this.mouseMoveTargetId !== hitBoxEvent.id) {\r\n        this.mouseOutCallback(htmlEv as HTMLElementEventMap[\"mouseout\"]);\r\n        this.mouseMoveTargetId = null;\r\n        this.mouseOutCallback = null;\r\n      }\r\n    }\r\n  };\r\n}\r\n", "import { CanvasScene2D } from \"../models/canvas-scene\";\nimport { SceneHandler } from \"./types/scene-handler\";\n\nexport class SceneManager implements SceneHandler {\n  private currentScenes: CanvasScene2D[] = [];\n  private scenes: CanvasScene2D[] = [];\n\n  addScene(scene: CanvasScene2D): void {\n    if (this.scenes.findIndex((s) => s.id === scene?.id) !== -1) {\n      console.warn(\"Scene with same id already exists, provide a new id\");\n      return;\n    }\n    this.scenes.push(scene);\n  }\n  deleteScene(id: string): void {\n    const i = this.getSceneIndex(id, this.currentScenes);\n    this.currentScenes[i].clean();\n    this.currentScenes = this.currentScenes.filter((_, index) => index !== i);\n  }\n  getCurrentScenes(): CanvasScene2D[] | undefined {\n    return this.currentScenes;\n  }\n\n  /**\n   * Changes the current scene to a new scene specified by the given ID.\n   *\n   * This function initializes the new scene, optionally initializes a loading scene, and updates\n   * the current scenes stack. It also handles cleaning up the previous scene state if specified.\n   *\n   * @param {string} id - The ID of the new scene to transition to.\n   * @param {boolean} [cleanPreviousState=true] - A flag indicating whether to clean up the previous scene state.\n   * @param {string} [loadingSceneId] - The ID of an optional loading scene to display while the new scene is initializing.\n   * @returns {Promise<void>} A promise that resolves when the scene transition is complete.\n   */\n  async changeScene(\n    id: string,\n    cleanPreviousState: boolean = true,\n    loadingSceneId?: string,\n  ): Promise<void> {\n    const lastCurrentSceneId =\n      this.currentScenes[this.currentScenes.length - 1]?.id;\n    const newScene = this.scenes[this.getSceneIndex(id, this.scenes)];\n\n    if (loadingSceneId !== undefined) {\n      const loadingSceneIndex = this.getSceneIndex(loadingSceneId, this.scenes);\n      let loadingScene: CanvasScene2D = this.scenes[loadingSceneIndex];\n      const loadingSceneInitPromises = loadingScene.init();\n      if (loadingSceneInitPromises !== undefined) {\n        await loadingSceneInitPromises;\n      }\n      this.currentScenes.push(loadingScene);\n    }\n\n    const newSceneInitPromises = newScene.init();\n\n    if (newSceneInitPromises !== undefined) {\n      await newSceneInitPromises;\n    }\n    if (cleanPreviousState && lastCurrentSceneId !== undefined) {\n      this.deleteScene(lastCurrentSceneId);\n    }\n    if (loadingSceneId !== undefined) {\n      this.deleteScene(loadingSceneId);\n    }\n    this.currentScenes.push(newScene);\n  }\n\n  private getSceneIndex(id: string, scenes: CanvasScene2D[]) {\n    const loadingSceneIndex = scenes.findIndex((s) => s.id === id);\n    if (loadingSceneIndex === -1) {\n      throw new Error(`cannot find scene with id ${id}`);\n    }\n    return loadingSceneIndex;\n  }\n}\n", "export const CANVAS_WIDTH = \"canvasW\";\r\nexport const CANVAS_HEIGHT = \"canvasH\";\r\n\r\nexport class Settings {\r\n  static SETTINGS_DI = \"settings\";\r\n  \r\n  private settings = new Map<string, unknown>();\r\n\r\n  get<T extends unknown>(key: string): T | undefined {\r\n    if (!this.settings.has(key)) {\r\n      return undefined;\r\n    }\r\n    return this.settings.get(key) as T;\r\n  }\r\n\r\n  set<T extends unknown>(key: string, value: T): void {\r\n    this.settings = this.settings.set(key, value);\r\n  }\r\n}\r\n", "import { createBoundingBox } from \"../helpers\";\r\nimport { BoundingBox } from \"./bbox\";\r\nimport { GameCycle } from \"./game-cycle\";\r\nimport { Size2 } from \"./size\";\r\nimport { Vec2 } from \"./vec\";\r\n\r\nexport abstract class BaseObject implements GameCycle {\r\n  _x: number = 0;\r\n  _y: number = 0;\r\n  width: number = 0;\r\n  height: number = 0;\r\n  canvas: HTMLCanvasElement | null = null;\r\n  bbox: BoundingBox<number> = {\r\n    nw: { x: 0, y: 0 },\r\n    se: { x: 0, y: 0 },\r\n  };\r\n  elements: BaseObject[] = [];\r\n\r\n  constructor() {}\r\n\r\n  async init(..._args: any): Promise<any> {}\r\n  async update(_deltaTime: number, ..._args: any): Promise<any> {}\r\n  render(..._args: any) {}\r\n  clean(..._args: any) {}\r\n\r\n  set x(v: number) {\r\n    this._x = v;\r\n    this.calcBBox();\r\n  }\r\n  get x(): number {\r\n    return this._x;\r\n  }\r\n  set y(v: number) {\r\n    this._y = v;\r\n    this.calcBBox();\r\n  }\r\n  get y(): number {\r\n    return this._y;\r\n  }\r\n\r\n  getPosition(): Vec2<number> {\r\n    return { x: this._x, y: this.y };\r\n  }\r\n  getBBox = (): BoundingBox<number> | undefined => {\r\n    return this.bbox;\r\n  };\r\n  calcBBox() {\r\n    this.bbox = createBoundingBox(this.x, this.y, this.width, this.height);\r\n  }\r\n  getSize(): Size2 | undefined {\r\n    return undefined;\r\n  }\r\n  getWidth(): number {\r\n    return this.width;\r\n  }\r\n  setWidth(width: number) {\r\n    this.width = width;\r\n    this.bbox = createBoundingBox(this._x, this.y, this.width, this.height);\r\n  }\r\n  getHeight(): number {\r\n    return this.height;\r\n  }\r\n  setHeight(height: number) {\r\n    this.height = height;\r\n    this.bbox = createBoundingBox(this._x, this.y, this.width, this.height);\r\n  }\r\n}\r\nexport class BaseObjectClass extends BaseObject {}\r\n", "import { Vec2 } from \"./vec\";\nimport { BoundingBox } from \"./bbox\";\nimport { GameCycle } from \"./game-cycle\";\nimport { GraphicContext } from \"./graphic-context\";\n\nexport abstract class GameObject<T = GraphicContext> implements GameCycle {\n  id?: string;\n  ctx: T;\n  protected width: number = 64;\n  protected height: number = 64;\n  protected position: Vec2<number> = { x: 0, y: 0 };\n  protected bbox: BoundingBox<number> = {\n    nw: { x: 0, y: 0 },\n    se: { x: 0, y: 0 },\n  };\n  protected direction: number = 0;\n\n  constructor(ctx: T) {\n    this.ctx = ctx;\n  }\n\n  async init(..._args: any) {}\n  async update(_deltaTime: number, ..._args: any) {}\n  render(..._args: any) {}\n  clean(..._args: any) {}\n\n  setPosition(value: Vec2<number>): void {\n    this.position = value;\n  }\n  getPosition(): Vec2<number> {\n    return this.position;\n  }\n\n  getSize(): Vec2<number> | undefined {\n    return undefined;\n  }\n\n  getDirection(): number {\n    return this.direction;\n  }\n  setDirection(value: number): void {\n    this.direction = value;\n  }\n\n  getWidth(): number {\n    return this.width;\n  }\n  setWidth(width: number) {\n    this.width = width;\n  }\n  getHeight(): number {\n    return this.height;\n  }\n  setHeight(height: number) {\n    this.height = height;\n  }\n}\n", "// Mainly taken from https://ricardoborges.dev/data-structures-in-typescript-linked-list\nexport class LinkedListNode<T> {\n  data: T;\n  next: LinkedListNode<T> | null = null;\n\n  constructor(data: T) {\n    this.data = data;\n  }\n}\n\nexport interface ILinkedList<T> {\n  append(data: T): LinkedListNode<T>;\n  delete(data: T): void;\n  search(data: T): LinkedListNode<T> | null;\n  traverse(): T[];\n  size(): number;\n}\n\nexport class LinkedList<T> implements ILinkedList<T> {\n  head: LinkedListNode<T> | null = null;\n  comparator: (a: T, b: T) => boolean;\n\n  constructor(comparator: (a: T, b: T) => boolean) {\n    this.comparator = comparator;\n  }\n\n  append(data: T): LinkedListNode<T> {\n    const newData = new LinkedListNode(data);\n    if (!this.head) {\n      this.head = newData;\n    } else {\n      let current = this.head;\n      while (current.next != null) {\n        current = current.next;\n      }\n      current.next = newData;\n    }\n    return newData;\n  }\n\n  delete(data: T): void {\n    if (!this.head) return;\n\n    // Check if the head node is the node to be removed\n    if (this.comparator(this.head.data, data)) {\n      this.head = this.head.next;\n      return;\n    }\n\n    let current = this.head.next;\n    let previous = this.head;\n\n    /**\n     * Search for the node to be removed and keep track of its previous node\n     **/\n    while (current) {\n      if (this.comparator(current.data, data)) {\n        current = null;\n      } else {\n        previous = current;\n        current = current.next;\n      }\n    }\n\n    /**\n     * set previous.next to the target.next, if the node target is not found,\n     * the 'previous' will point to the last node,\n     * since the last node hasn't next, nothing will happen\n     **/\n    previous.next = previous.next ? previous.next.next : null;\n  }\n\n  search(data: T): LinkedListNode<T> | null {\n    let current = this.head;\n    while (current) {\n      if (this.comparator(current.data, data)) {\n        return current;\n      }\n      current = current.next;\n    }\n    return null;\n  }\n\n  traverse() {\n    // taken from https://dev.to/glebirovich/typescript-data-structures-linked-list-3o8i\n    const array: T[] = [];\n    if (!this.head) {\n      return array;\n    }\n\n    const addToArray = (node: LinkedListNode<T>): T[] => {\n      array.push(node.data);\n      return node.next ? addToArray(node.next) : array;\n    };\n    return addToArray(this.head);\n  }\n\n  size(): number {\n    return this.traverse().length;\n  }\n}\n", "// TODO\r\nimport { BoundingBox, Vec2 } from \"../\";\r\n\r\nexport class QuadTree {\r\n    // Arbitrary constant to indicate how many elements can be stored in this quad tree node\r\n    readonly QT_NODE_CAPACITY: number | undefined;\r\n\r\n    // Axis-aligned bounding box stored as a center with half-dimensions\r\n    // to represent the boundaries of this quad tree\r\n    private boundary: BoundingBox<number>;\r\n\r\n    // Points in this quad tree node\r\n    private points: Vec2<number>[] = [];\r\n\r\n    // Children\r\n    northWest: QuadTree | undefined;\r\n    northEast: QuadTree | undefined;\r\n    southWest: QuadTree | undefined;\r\n    southEast: QuadTree | undefined;\r\n\r\n    // Methods\r\n    constructor(boundary: BoundingBox<number>) {\r\n        this.boundary = boundary;\r\n    }\r\n\r\n    insert(p: Vec2<number>): void {\r\n        this.points.push(p);\r\n    }\r\n\r\n    subdivide(): void {\r\n        const xLength = (this.boundary.se.x - this.boundary.nw.x) / 2;\r\n        const yLength = (this.boundary.nw.y - this.boundary.se.y) / 2;\r\n\r\n        // create four children that fully divide this quad into four quads of equal area\r\n        this.northWest = new QuadTree({\r\n            nw: this.boundary.nw,\r\n            se: { x: this.boundary.nw.x + xLength, y: this.boundary.nw.y + yLength },\r\n        });\r\n        this.northEast = new QuadTree({\r\n            nw: { x: this.boundary.nw.x + xLength, y: this.boundary.nw.y },\r\n            se: { x: this.boundary.se.x, y: this.boundary.nw.y + yLength },\r\n        });\r\n        this.southWest = new QuadTree({\r\n            nw: { x: this.boundary.nw.x, y: this.boundary.nw.y + yLength },\r\n            se: { x: this.boundary.nw.x + xLength, y: this.boundary.se.y },\r\n        });\r\n        this.southEast = new QuadTree({\r\n            nw: { x: this.boundary.nw.x + xLength, y: this.boundary.nw.y + yLength },\r\n            se: this.boundary.se\r\n        });\r\n    }\r\n\r\n    queryRange(_range: BoundingBox<number>): Vec2<number>[] | undefined {\r\n        return undefined\r\n    }\r\n}\r\n", "import { Vec2 } from \"./vec\";\n\nexport type UnitVector = {\n  position: Vec2<number>;\n  direction: number;\n};\n\nexport function pivotComparator(p1: UnitVector, p2: UnitVector) {\n  return (\n    p1.position.x === p2.position.x &&\n    p1.position.y === p2.position.y &&\n    p1.direction === p2.direction\n  );\n}\n", "import { DIContainer, InteractionManager } from \"../core\";\r\nimport { createBoundingBox } from \"../helpers\";\r\nimport { BaseObject, BoundingBox } from \"../models\";\r\n\r\nconst UIWINDOW_HITBOX_KEY = \"uiwindow-dragging-hitbox\";\r\n\r\nexport type WithInitialPosition = {\r\n  initialX: number;\r\n  initialY: number;\r\n};\r\ntype DraggableChild = BaseObject & Partial<WithInitialPosition>;\r\n\r\nexport class DraggableObject extends BaseObject {\r\n  interactionManager = DIContainer.getInstance().resolve<InteractionManager>(\r\n    InteractionManager.INTERACTION_MANAGER_ID\r\n  );\r\n\r\n  isDragging = false;\r\n  dragStartX: number = 0;\r\n  dragStartY: number = 0;\r\n  initialX: number = 0;\r\n  initialY: number = 0;\r\n  draggingId: string = UIWINDOW_HITBOX_KEY;\r\n\r\n  override elements: DraggableChild[] = [];\r\n\r\n  boundingBox: BoundingBox<number> = {\r\n    nw: { x: 0, y: 0 },\r\n    se: { x: 0, y: 0 },\r\n  };\r\n\r\n  constructor(...args: any[]) {\r\n    super(...(args as []));\r\n  }\r\n\r\n  registerDragging = (id?: string) => {\r\n    if (this.canvas === null) {\r\n      return;\r\n    }\r\n    this.draggingId = id ?? UIWINDOW_HITBOX_KEY;\r\n    this.interactionManager.upsertHitbox(this.draggingId, {\r\n      getBoundingBox: this.getBBox,\r\n      callbacks: {\r\n        mousemove: this._mouseHover,\r\n        mousedown: this._mouseDown,\r\n        mouseup: this._mouseUp,\r\n      },\r\n      color: this.interactionManager.colorHeap.getNext(),\r\n    });\r\n  };\r\n\r\n  deregister = () => {\r\n    this.interactionManager.removeHitbox(this.draggingId);\r\n  };\r\n\r\n  override getBBox = () => {\r\n    return createBoundingBox(this.x, this.y, this.width, this.height);\r\n  };\r\n\r\n  _mouseHover = (ev: MouseEvent): void => {\r\n    if (!this.isDragging) {\r\n      return;\r\n    }\r\n    // We are finally dragging, update position of element and sub-elements\r\n    const deltaX = ev.offsetX - this.dragStartX;\r\n    const deltaY = ev.offsetY - this.dragStartY;\r\n    this.x = this.initialX + deltaX;\r\n    this.y = this.initialY + deltaY;\r\n    for (let i = 0; i < this.elements.length; i++) {\r\n      const el = this.elements[i];\r\n      const initialX = el.initialX ?? el.x;\r\n      const initialY = el.initialY ?? el.y;\r\n      el.x = initialX + deltaX;\r\n      el.y = initialY + deltaY;\r\n    }\r\n\r\n    // Update boundingBox in the event Handler\r\n    this.boundingBox = createBoundingBox(\r\n      this.x,\r\n      this.y,\r\n      this.width,\r\n      this.height\r\n    );\r\n    this.interactionManager.upsertHitbox(this.draggingId, {\r\n      getBoundingBox: this.getBBox,\r\n    });\r\n  };\r\n\r\n  _mouseDown = (ev: MouseEvent): void => {\r\n    if (\r\n      ev.buttons !== 1 ||\r\n      this.isDragging\r\n    ) {\r\n      return;\r\n    }\r\n    this.isDragging = true;\r\n    this.dragStartX = ev.clientX;\r\n    this.dragStartY = ev.clientY;\r\n    this.initialX = this.x;\r\n    this.initialY = this.y;\r\n\r\n    this.elements.forEach((el) => {\r\n      el.initialX = el.x;\r\n      el.initialY = el.y;\r\n    });\r\n\r\n    this.interactionManager.upsertHitbox(this.draggingId, {\r\n      data: { isDragging: true },\r\n    });\r\n  };\r\n\r\n  _mouseUp = (_ev: MouseEvent): void => {\r\n    this.isDragging = false;\r\n    this.interactionManager.upsertHitbox(this.draggingId, {\r\n      data: { isDragging: false },\r\n    });\r\n  };\r\n}\r\n// }\r\n", "import { DIContainer, InteractionManager } from \"../core\";\r\nimport { BaseObject, BaseObjectClass, Constructor } from \"../models\";\r\n\r\nexport interface hasInteractionManager {\r\n  interactionManager: InteractionManager;\r\n}\r\n\r\nexport function withInteractionManager<T extends Constructor<BaseObject>>(\r\n  obj: T = BaseObjectClass as T\r\n): T & Constructor<hasInteractionManager> {\r\n  return class extends obj implements hasInteractionManager {\r\n    interactionManager = DIContainer.getInstance().resolve<InteractionManager>(\r\n      InteractionManager.INTERACTION_MANAGER_ID\r\n    );\r\n\r\n    constructor(...args: any[]) {\r\n      super(...args);\r\n    }\r\n  };\r\n}\r\n", "import { BoundingBox, Vec2 } from \"../../../models\";\n\nexport function getTextBBox(\n  ctx: CanvasRenderingContext2D,\n  text: string,\n  position: Vec2<number>\n): BoundingBox<number> {\n  // Measure the text\n  const metrics: TextMetrics = ctx.measureText(text);\n\n  // Calculate the bounding box coordinates\n  const nw: Vec2<number> = {\n    x: position.x + metrics.actualBoundingBoxLeft,\n    y: position.y - metrics.actualBoundingBoxAscent,\n  };\n  const se: Vec2<number> = {\n    x: position.x + metrics.actualBoundingBoxRight,\n    y: position.y - metrics.actualBoundingBoxDescent,\n  };\n\n  return { nw, se };\n}\n\nexport function getWrappedTextLines(\n  ctx: CanvasRenderingContext2D,\n  text: string,\n  maxWidth: number\n): string[] {\n  var words = text.split(\" \");\n  var lines = [];\n  var currentLine = words[0];\n\n  for (var i = 1; i < words.length; i++) {\n    var word = words[i];\n    var width = ctx.measureText(currentLine + \" \" + word).width;\n    if (width < maxWidth) {\n      currentLine += \" \" + word;\n    } else {\n      lines.push(currentLine);\n      currentLine = word;\n    }\n  }\n  lines.push(currentLine);\n  return lines;\n}\n", "import { DIContainer, InteractionManager } from \"../../core\";\r\nimport { createBoundingBox } from \"../../helpers\";\r\nimport { BaseObject, Color, colorToString } from \"../../models\";\r\n\r\nconst UIBUTTON_HITBOX_KEY = \"ui-button-hitbox\";\r\n\r\nconst UIBUTTON_BACKGROUND_COLOR: Color = { r: 100, g: 100, b: 100, a: 255 };\r\nconst UIBUTTON_HOVER_COLOR: Color = { r: 150, g: 150, b: 150, a: 255 };\r\nconst UIBUTTON_ACTIVE_COLOR: Color = { r: 200, g: 200, b: 200, a: 255 };\r\nconst UIBUTTON_TEXT_COLOR: Color = { r: 255, g: 255, b: 255, a: 255 };\r\n\r\nexport class UIButton extends BaseObject {\r\n  protected interactionManager =\r\n    DIContainer.getInstance().resolve<InteractionManager>(\r\n      InteractionManager.INTERACTION_MANAGER_ID\r\n    );\r\n  protected ctx: CanvasRenderingContext2D;\r\n  backgroundColor: Color = UIBUTTON_BACKGROUND_COLOR;\r\n  hoverColor: Color = UIBUTTON_HOVER_COLOR;\r\n  textColor: Color = UIBUTTON_TEXT_COLOR;\r\n  activeColor: Color = UIBUTTON_ACTIVE_COLOR;\r\n\r\n  isHovering = false;\r\n  layer: number = 50;\r\n  hitBoxId: string = UIBUTTON_HITBOX_KEY;\r\n\r\n  constructor(\r\n    canvas: HTMLCanvasElement,\r\n    ctx: CanvasRenderingContext2D,\r\n    hitBoxId: string\r\n  ) {\r\n    super();\r\n    this.ctx = ctx;\r\n    this.canvas = canvas;\r\n    this.hitBoxId = hitBoxId;\r\n  }\r\n\r\n  override async init(layer: number = 50): Promise<void> {\r\n    await super.init();\r\n    this.layer = layer;\r\n    this.interactionManager.upsertHitbox(this.hitBoxId, {\r\n      callbacks: {\r\n        mousemove: this.mouseMove,\r\n        mouseout: this.mouseOut,\r\n      },\r\n      color: this.interactionManager.colorHeap.getNext(),\r\n      layer,\r\n      getBoundingBox: this.getBBox,\r\n    });\r\n  }\r\n\r\n  override async update(_deltaTime: number): Promise<void> {\r\n    await super.update(_deltaTime);\r\n  }\r\n\r\n  override clean(..._args: any): void {\r\n    super.clean();\r\n    this.interactionManager.removeHitbox(UIBUTTON_HITBOX_KEY);\r\n  }\r\n\r\n  override render(): void {\r\n    this.ctx.fillStyle = this.isHovering\r\n      ? colorToString(this.hoverColor)\r\n      : colorToString(this.backgroundColor);\r\n    this.ctx.fillRect(this.x, this.y, this.width, this.height);\r\n  }\r\n\r\n  override getBBox = () => {\r\n    return createBoundingBox(this.x, this.y, this.width, this.height);\r\n  };\r\n\r\n  mouseMove = (ev: MouseEvent): void => {\r\n    if (ev.offsetX === undefined || ev.offsetY === undefined) {\r\n      return;\r\n    }\r\n    this.isHovering = true;\r\n  };\r\n\r\n  mouseOut = (_ev: MouseEvent): void => {\r\n    this.isHovering = false;\r\n  };\r\n}\r\n", "import { BaseObject, BoundingBox, Size2 } from \"../../models\";\nimport { FillStrokeStyle, getTextBBox } from \"../canvas\";\n\nexport class UILabel extends BaseObject {\n  id: string | undefined;\n  protected ctx: CanvasRenderingContext2D | undefined;\n  protected text: string | undefined;\n  protected textStyle: Partial<CanvasTextDrawingStyles> | undefined;\n  protected textFillStyle: FillStrokeStyle = \"#000\";\n  protected textStrokeStyle: FillStrokeStyle = \"#000\";\n\n  constructor() {\n    super();\n  }\n\n  override async init() {}\n  override async update() {\n    if (this.text === undefined || this.ctx === undefined) {\n      return;\n    }\n    this.calcBBox();\n  }\n  override render() {\n    if (this.text === undefined || this.ctx === undefined) {\n      return;\n    }\n\n    this.applyStyles();\n\n    this.ctx.moveTo(this.x, this.y);\n    this.ctx.strokeText(this.text, this.x, this.y);\n    this.ctx.fillText(this.text, this.x, this.y);\n  }\n  override clean() {}\n\n  setText(text: string) {\n    this.text = text;\n  }\n\n  override getSize(): Size2 | undefined {\n    if (\n      this.textFillStyle === undefined ||\n      this.textStrokeStyle === undefined ||\n      this.text === undefined ||\n      this.ctx === undefined\n    ) {\n      return;\n    }\n\n    this.applyStyles();\n    const textMetrics = this.ctx.measureText(this.text);\n\n    if (textMetrics === undefined) {\n      return undefined;\n    }\n    return {\n      width: textMetrics.width,\n      height:\n        textMetrics?.fontBoundingBoxAscent + textMetrics.fontBoundingBoxDescent,\n    };\n  }\n  override getBBox = (): BoundingBox<number> | undefined => {\n    if (!this.ctx) {\n      return undefined;\n    }\n    return getTextBBox(this.ctx, this.text ?? \"\", { x: this.x, y: this.y });\n  };\n  override calcBBox(): void {\n    if (this.text === undefined || this.ctx === undefined) {\n      return;\n    }\n    this.bbox = getTextBBox(this.ctx, this.text, { x: this.x, y: this.y });\n  }\n\n  setTextFillStyle(style: FillStrokeStyle) {\n    this.textFillStyle = style;\n  }\n  setTextStrokeStyle(style: FillStrokeStyle) {\n    this.textStrokeStyle = style;\n  }\n  setTextStyle(textStyle: CanvasTextDrawingStyles) {\n    this.textStyle = textStyle;\n  }\n\n  protected applyStyles() {\n    if (this.ctx === undefined) {\n      return;\n    }\n    //TODO add direction\n    this.ctx.font = this.textStyle?.font ?? \"20px Verdana\";\n    //TODO addfontKerning\n    //TODO addfontStretch\n    //TODO addfontVariantCaps\n    //TODO addletterSpacing\n    this.ctx.textAlign = this.textStyle?.textAlign ?? \"left\";\n    this.ctx.textBaseline = this.textStyle?.textBaseline ?? \"alphabetic\";\n    //TODO add textRendering\n    //TODO add wordSpacing\n\n    if (this.textStrokeStyle !== undefined) {\n      this.ctx.strokeStyle = this.textStrokeStyle;\n    }\n    if (this.textFillStyle !== undefined) {\n      this.ctx.fillStyle = this.textFillStyle;\n    }\n  }\n}\n", "import { GameObject, Vec2 } from \"../../models\";\r\nimport { FillStrokeStyle } from \"../canvas\";\r\n\r\nconst MENUNODES_FONT_SIZE = 48;\r\nconst MENUNODES_GAP = 8;\r\nconst MENUNODES_STYLE: CanvasTextDrawingStyles = {\r\n  direction: \"inherit\",\r\n  font: `${MENUNODES_FONT_SIZE} sans-serif`,\r\n  fontKerning: \"auto\",\r\n  fontStretch: \"normal\",\r\n  fontVariantCaps: \"normal\",\r\n  letterSpacing: \"normal\",\r\n  textAlign: \"start\",\r\n  textBaseline: \"alphabetic\",\r\n  textRendering: \"auto\",\r\n  wordSpacing: \"normal\",\r\n};\r\n// const MENUNODES_STROKE_COLOR = \"#00FFad\";\r\n// const MENUNODES_FILL_COLOR = \"#204Fa1\";\r\n// const MENUNODES_MOUSE_ENETER_FILL_COLOR = \"#a22\";\r\n\r\nexport type TreeItem = {\r\n  id: string;\r\n  text: string;\r\n  nodes?: TreeItem[];\r\n};\r\n\r\nexport class UIPanel extends GameObject<CanvasRenderingContext2D> {\r\n  pos: Vec2<number> = { x: 0, y: 0 };\r\n  fillStyle: FillStrokeStyle | undefined;\r\n  strokeStyle: FillStrokeStyle | undefined;\r\n  textStyle: CanvasTextDrawingStyles | undefined = MENUNODES_STYLE;\r\n\r\n  protected override width: number = 0;\r\n  protected override height: number = 0;\r\n\r\n  private items: GameObject[] = [];\r\n  private allItemsHeight = 0;\r\n  private heightGap: number = MENUNODES_GAP;\r\n\r\n  constructor(ctx: CanvasRenderingContext2D) {\r\n    super(ctx);\r\n  }\r\n\r\n  override async init(...args: any): Promise<void> {\r\n    super.init(args);\r\n  }\r\n  override async update(deltaTime: number, ...args: any): Promise<void> {\r\n    super.update(deltaTime, args);\r\n    this.items.forEach((i) => i.update(deltaTime, args));\r\n  }\r\n  override clean(...args: any): void {\r\n    super.clean(args);\r\n    this.items.forEach((i) => i.clean(args));\r\n  }\r\n\r\n  override render(...args: any): void {\r\n    if (this.fillStyle !== undefined) {\r\n      this.ctx.fillStyle = this.fillStyle;\r\n    }\r\n    if (this.strokeStyle !== undefined) {\r\n      this.ctx.strokeStyle = this.strokeStyle;\r\n    }\r\n    this.ctx.fillRect(this.pos.x, this.pos.y, this.width, this.height);\r\n\r\n    this.items.forEach((i) => i.render(args));\r\n  }\r\n\r\n  addPanelItem(gameObject: GameObject): void {\r\n    if (gameObject === undefined) {\r\n      return;\r\n    }\r\n    this.items.push(gameObject);\r\n\r\n    // Reposition items\r\n    let currentHeightPosition = this.getPosition().y;\r\n    let currentWidthPosition = this.getPosition().y;\r\n\r\n    this.items.forEach((go) => {\r\n      go.setPosition({ x: currentWidthPosition, y: currentHeightPosition });\r\n      currentHeightPosition += this.heightGap + (go.getSize()?.y ?? 0);\r\n    });\r\n  }\r\n  getPanelItem(id: string): GameObject | undefined {\r\n    return this.items.find((i) => i.id === id);\r\n  }\r\n\r\n  setHeightGap(value: number) {\r\n    this.heightGap = value;\r\n  }\r\n  setFillStyle(value: FillStrokeStyle) {\r\n    this.fillStyle = value;\r\n  }\r\n  setStrokeStyle(value: FillStrokeStyle) {\r\n    this.strokeStyle = value;\r\n  }\r\n\r\n  // TODO: implement\r\n  // @ts-expect-error ts(6133)\r\n  private calcContentHeight() {\r\n    this.items.forEach((i) => {\r\n      this.allItemsHeight += i.getSize()?.y ?? 0;\r\n    });\r\n  }\r\n}\r\n", "import { DraggableObject } from \"../../mixins\";\r\n\r\nexport const HEADER_HEIGHT = 30;\r\n\r\nexport class UIWindow extends DraggableObject {\r\n  protected ctx: CanvasRenderingContext2D;\r\n\r\n  protected backgroundcolor = \"rgba(50, 50, 50, 0.8)\";\r\n  protected borderColor = \"black\";\r\n  protected borderWidth = 2;\r\n  protected textColor = \"white\";\r\n  protected title: string = \"UI Window\";\r\n\r\n  constructor(canvas: HTMLCanvasElement, ctx: CanvasRenderingContext2D) {\r\n    super();\r\n    this.canvas = canvas;\r\n    this.ctx = ctx;\r\n\r\n    // Initialize position and size (these properties come from BaseObject)\r\n    this.x = 100;\r\n    this.y = 100;\r\n    this.width = 300;\r\n    this.height = 200;\r\n  }\r\n\r\n  override async init(\r\n    _deltaTime: number,\r\n    id: string,\r\n    ..._args: []\r\n  ): Promise<any> {\r\n    this.registerDragging(id);\r\n  }\r\n  override async update(_deltaTime: number): Promise<any> {}\r\n  override render() {\r\n    if (\r\n      this.canvas === null ||\r\n      this.x === null ||\r\n      this.y === null ||\r\n      this.width === null ||\r\n      this.height === null\r\n    ) {\r\n      return;\r\n    }\r\n    this.ctx.fillStyle = this.backgroundcolor;\r\n    this.ctx.fillRect(this.x, this.y, this.width, this.height);\r\n    this.ctx.strokeStyle = this.borderColor;\r\n    this.ctx.lineWidth = this.borderWidth;\r\n    this.ctx.strokeRect(this.x, this.y, this.width, this.height);\r\n\r\n    this.renderWindowHeader(\r\n      this.ctx,\r\n      { x: this.x, y: this.y },\r\n      this.width,\r\n      HEADER_HEIGHT,\r\n      this.title,\r\n      true\r\n    );\r\n  }\r\n  override clean() {\r\n    this.deregister();\r\n  }\r\n\r\n  private renderWindowHeader(\r\n    ctx: CanvasRenderingContext2D,\r\n    position: { x: number; y: number },\r\n    width: number,\r\n    height: number,\r\n    title: string,\r\n    showCloseButton: boolean = true\r\n  ) {\r\n    // Draw header background\r\n    ctx.fillStyle = \"#333\";\r\n    ctx.fillRect(position.x, position.y, width, height);\r\n\r\n    // Draw header border\r\n    ctx.strokeStyle = \"#000\";\r\n    ctx.lineWidth = 2;\r\n    ctx.strokeRect(position.x, position.y, width, height);\r\n\r\n    // Draw title text\r\n    ctx.fillStyle = \"white\";\r\n    ctx.font = \"12px Arial\";\r\n    ctx.fillText(title, position.x + 10, position.y + 20);\r\n\r\n    // Draw close button if needed\r\n    if (showCloseButton) {\r\n      const buttonSize = 16;\r\n      ctx.fillStyle = \"#ff5555\";\r\n      ctx.fillRect(\r\n        position.x + width - buttonSize - 10,\r\n        position.y + 7,\r\n        buttonSize,\r\n        buttonSize\r\n      );\r\n      ctx.strokeStyle = \"#000\";\r\n      ctx.lineWidth = 2;\r\n      ctx.strokeRect(\r\n        position.x + width - buttonSize - 10,\r\n        position.y + 7,\r\n        buttonSize,\r\n        buttonSize\r\n      );\r\n      ctx.fillStyle = \"white\";\r\n      ctx.font = \"12px Arial\";\r\n      ctx.fillText(\"X\", position.x + width - buttonSize - 6, position.y + 20);\r\n    }\r\n  }\r\n}\r\n"],
  "mappings": "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",
  "names": ["callback"]
}
